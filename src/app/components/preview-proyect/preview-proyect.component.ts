import { Component } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { Router } from '@angular/router';
import { ProyectoService } from '../../core/services/proyecto.service';
import { HeaderComponent } from "../header/header.component";
import { CommonModule } from '@angular/common';


@Component({
  selector: 'app-preview-proyect',
  imports: [FormsModule, HeaderComponent,CommonModule],
  templateUrl: './preview-proyect.component.html',
  styleUrl: './preview-proyect.component.css'
})
export class PreviewProyectComponent {
    titulo: string = '';
  descripcion: string = '';

  tituloError: string = '';
  descripcionError: string = '';

  plantillaNombre: string = '';

  constructor(
    private router: Router,
    private proyectoService: ProyectoService
  ) {}

  ngOnInit(): void {
    // ‚úÖ Verificar si hay plantilla cargada
    const proyectoTemporal = this.proyectoService.getProyectoTemporal();
    
    if (proyectoTemporal?.plantillaData) {
      this.plantillaNombre = proyectoTemporal.plantillaData.nombre || 
                            proyectoTemporal.plantillaData.titulo || 
                            'Plantilla seleccionada';
      console.log('üìã Plantilla detectada:', this.plantillaNombre);
    } else {
      console.log('‚ö†Ô∏è No hay plantilla seleccionada');
    }
  }

  
  empezar(): void {
    // Validaciones
    this.tituloError = '';
    this.descripcionError = '';

    if (!this.titulo.trim()) {
      this.tituloError = 'El t√≠tulo es obligatorio';
      return;
    }

    if (this.titulo.length < 3) {
      this.tituloError = 'El t√≠tulo debe tener al menos 3 caracteres';
      return;
    }

    // ‚úÖ Actualizar solo metadatos (mantiene plantilla)
    this.proyectoService.actualizarMetadatos(this.titulo, this.descripcion);

    // ‚úÖ DEBUG: Verificar datos antes de navegar
    const datosFinales = this.proyectoService.getProyectoTemporal();
    console.log('üìä Datos completos antes de navegar al editor:', {
      titulo: datosFinales?.titulo,
      descripcion: datosFinales?.descripcion,
      tienePlantilla: !!datosFinales?.plantillaData,
      nombrePlantilla: datosFinales?.plantillaData?.nombre
    });

    // Redirigir al editor
    this.router.navigate(['/editor']);
  }

}
